{% extends "tpl/html/_base.html.j2" %}

{% block player %}
<div style="width: 100%; height: 600px; overflow: hidden;">
    <video id="{{html.player_id}}" style="width: 100%;" poster="{{html.poster}}" controls />
</div>
{% endblock player %}

{% block js_body %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/dashjs/2.4.1/dash.all.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function (event) {
    var video_element = document.getElementById("{{html.player_id}}");
    if (window.MediaSource) {
        // For good web browsers, use dash.js
        player = dashjs.MediaPlayer().create();
        player.initialize(video_element, null, true);
        player.setFastSwitchEnabled(true);
        player.attachSource("{{dash_url}}/{{html.video_id}}/index.mpd");
    } else {
    {% if nginx.hls.enabled %}
        // Use hls for Safari on iOS.
	video_element.src = "{{hls_url}}/{{html.video_id}}/index.m3u8";
    {% else %}
        alert("Stream not available on iOS/Safari.");
    {% endif %}
    }
});
</script>
{% endblock js_body %}

{# vim: set ft=html: #}
